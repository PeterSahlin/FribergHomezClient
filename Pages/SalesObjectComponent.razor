@page "/SalesObjectComponent"
@using FribergHomezClient.Models
@using System.Net.Http.Json
@using System.Text.Json
@inject HttpClient httpClient


<img class="saleObjectImage" src="images/FribergHomezLogo.jpeg" />



<PageTitle>Sale Objects</PageTitle>

<h1>Sales Objects</h1>

<div>
    <label for="municipalityDropdown">Select Municipality: </label>
    <select id="municipalityDropdown" @onchange="HandleMunicipalityChangeDropDown">
        <option value="0">All Municipalities</option>
        @foreach (var municipality in Municipalities)
        {
            <option value="@municipality.Id">@municipality.Name</option>
        }
    </select>
</div>

@if (SaleObjects == null)
{
    <p> Couldn't load sale objects.</p>
}

else
{
    <table>
        <thead>
            <tr>
                <th>Adress</th>
                <th>StartingPrice</th>
                <th>LivingArea</th>
                <th>AncillaryArea</th>
                <th>PlotArea</th>
                <th>Description</th>
                <th>NumberOfRooms</th>
                <th>MonthlyFee</th>
                <th>Operating Cost Per Year</th>
                <th>Year of Construction</th>
                <th>CategoryId</th>
                <th>RealEstateAgentId</th>
                <th>MunicipalityId</th>
                <th>Images</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in FilteredSaleObject)
            {
                <tr>
                    <td>@item.Address</td>
                    <td>@item.StartingPrice</td>
                    <td>@item.LivingArea</td>
                    <td>@item.AncillaryArea</td>
                    <td>@item.PlotArea</td>
                    <td>@item.Description</td>
                    <td>@item.NumberOfRooms</td>
                    <td>@item.MonthlyFee</td>
                    <td>@item.OperatingCostPerYear</td>
                    <td>@item.YearOfConstruction</td>
                    <td>@item.CategoryId</td>
                    <td>@item.RealEstateAgentId</td>
                    <td>@item.MunicipalityId</td>
                    <td>
                        @foreach (var image in item.ImageUrl)
                        {
                            <img class="saleObjectImage" src=@image />
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
}


@code {
    public List<SaleObject>? SaleObjects;
    public List<SaleObject>? FilteredSaleObject;
    public List<Municipality> Municipalities = new List<Municipality>();
    protected override async Task OnInitializedAsync()
    {

        var response = await httpClient.GetAsync("/api/salesobject");
        if (response.IsSuccessStatusCode)
        {
            SaleObjects = await response.Content.ReadFromJsonAsync<List<SaleObject>>();
            FilteredSaleObject = SaleObjects;
        }
        var municipalityResponse = await httpClient.GetAsync("/api/municipalities");
        if (municipalityResponse.IsSuccessStatusCode)
        {
            Municipalities = await municipalityResponse.Content.ReadFromJsonAsync<List<Municipality>>();
        }
    }
    private void HandleMunicipalityChangeDropDown(ChangeEventArgs e)
    {
        var selectedMunicipalityId = Convert.ToInt32(e.Value);
        if (selectedMunicipalityId == 0)
        {
            FilteredSaleObject = SaleObjects;
        }
        else
        {
            FilteredSaleObject = SaleObjects.Where(s => s.MunicipalityId == selectedMunicipalityId).ToList();
        }
    }
}

