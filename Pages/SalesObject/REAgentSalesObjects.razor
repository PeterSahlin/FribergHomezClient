@page "/SalesObject/REAgentSalesObjects"
@using FribergHomezClient.Models
@using System.Net.Http.Json
@using System.Text.Json
@inject HttpClient httpClient

<h3 class="mb-4">Mina försäljningsobjekt</h3>
@if (MySalesObjectList != null)
{
    <p class="mb-4">Inloggad mäklare: @MySalesObjectList.FirstOrDefault(r => r.RealEstateAgentId == LoggedInAgent).RealEstateAgent.FullName</p>
}
else
{
    <p class="text-danger mb-4">Kunde inte ladda försäljningsobjekt.</p>
}

@if (MySalesObjectList == null)
{
    <p class="text-danger mb-4">Kunde inte ladda försäljningsobjekt.</p>
}
else
{
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Status</th>
                    <th>Adress</th>
                    <th>Beskrivning</th>
                    <th>Utgångspris</th>
                    <th>Kategori</th>
                    <th>Kommun</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in MySalesObjectList)
                {
                    <tr>
                        <td>
                            @if (item.IsActive == false)
                            {
                                <span class="badge bg-danger">Inaktiv</span>
                            }
                            else
                            {
                                <span class="badge bg-success">Aktiv</span>
                            }
                        </td>
                        <td>@item.Address</td>
                        <td>@item.Description</td>
                        <td>@item.StartingPrice.ToString("N0") kr</td>
                        <td>@item.Category.Name</td>
                        <td>@item.Municipality.Name</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}

@code
{
    //properties
    public int LoggedInAgent { get; set; }
    public List<SaleObject>? AllSalesObjectList { get; set; }
    public List<SaleObject>? MySalesObjectList { get; set; }

    //methods
    protected override async Task OnInitializedAsync()
    {
        LoggedInAgent = 1; //Sätt till inloggad user efter identity
        var response = await httpClient.GetAsync("/api/salesobject");
        if (response == null)
        {

        }
        if (response.IsSuccessStatusCode)
        {
            AllSalesObjectList = await response.Content.ReadFromJsonAsync<List<SaleObject>>();
            MySalesObjectList = AllSalesObjectList.Where(o => o.RealEstateAgentId == LoggedInAgent).ToList();
        }
    }

    /*
    * variabel för att ta emot respons från API
    *variabel för att lagra vilken mäklare som är inloggad.
    * Lista av saleobjects som har realestateagentid == inloggadmäklare
    * Visa saleobjects med inloggadmäklares id.
    *
    *
    *
    *
    * */
}
